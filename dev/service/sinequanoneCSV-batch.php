<?php

$csv = "
50024962,69
50024963,238
50024964,129
50024965,297
50024966,149
50024968,79
50024969,168
50024971,69
50024972,45
50024973,129
50024974,129
50024976,119
50024977,79
50024979,89
50024980,60
50024982,170
50024983,134
50024984,89
50024986,267
50024987,178
50024988,89
50024989,178
50024992,208
50024993,322
50024994,79
50024996,391
50024997,128
50024998,118
50025000,308
50025002,179
50025003,184
50025004,179
50025005,179
50025006,214
50025008,95
50025010,139
50025011,89
60029173,89
60029174,15
60029176,128
60029178,124
60029179,139
60029180,99
60029181,139
60029182,89
60029183,178
60029184,119
60029187,69
60029188,89
60029190,79
60029192,249
60029194,168
60029195,224
60029196,176
60029197,158
60029199,357
60029200,69
60029201,307
60029202,154
60029203,336
60029207,327
60029208,99
60029210,110
60029212,535
60029213,69
60029214,273
60029215,160
60029216,193
60029217,254
60029218,198
60029219,164
60029220,166
60029223,395
60029224,89
60029225,208
60029228,95
60029229,95
60029230,89
60029231,49
170013342,168
170013343,164
170013344,189
170013345,145
170013346,79
170013347,482
170013348,183
170013349,149
170013350,80
170013351,129
170013352,228
170013353,100
170013354,95
170013355,100
170013356,89
170013357,99
170013359,69
170013360,148
170013361,178
170013363,178
170013364,178
170013365,168
170013367,75
170013368,208
170013369,119
170013370,258
170013371,134
170013373,89
170013374,150
170013375,154
170013376,248
170013377,218
170013380,228
170013381,187
170013384,297
170013385,315
170013386,99
170013387,168
170013388,168
170013389,208
170013390,346
170013391,227
170013392,89
170013394,169
170013395,148
170013396,89
170013397,99
170013398,168
170013399,79
170013400,59
170013401,90
170013402,45
170013403,129
170013404,119
180011720,119
180011721,79
180011722,178
180011723,119
180011724,49
180011725,69
180011727,247
180011733,119
180011734,138
180011735,69
180011736,129
180011737,89
180011738,119
180011741,267
180011742,99
180011743,269
180011744,327
180011745,134
180011746,154
180011747,119
180011748,174
180011749,333
180011750,174
180011751,362
180011752,258
180011753,178
180011754,178
180011755,168
180011756,178
180011758,89
180011759,218
180011760,465
180011762,198
180011765,248
180011766,273
180011767,237
180011768,204
180011769,148
180011770,168
180011771,218
180011772,168
180011773,273
180011774,238
180011776,79
180011777,318
180011778,218
180011779,198
180011780,309
180011781,164
180011782,423
180011783,238
180011785,158
180011786,144
180011787,570
180011788,59
180011789,229
180011790,85
180011791,168
180011792,89
180011793,95
180011794,129
180011795,168
180011796,119
190012933,421
190012934,149
190012936,129
190012937,179
190012940,149
190012946,178
190012950,258
190012951,333
190012952,89
190012953,69
190012954,75
190012955,218
190012956,209
190012959,89
190012960,257
190012961,148
190012964,128
190012965,283
190012969,292
190012970,99
190012974,228
190012975,218
190012981,69
190012982,228
190012984,338
190012987,268
190012988,461
190012992,178
190013000,178
190013001,274
190013007,631
200018875,495
200018878,158
200018885,69
200018886,39
200018887,268
200018893,138
200018898,303
200018900,119
200018904,179
200018905,129
200018906,327
200018915,79
200018916,244
200018924,99
200018925,308
200018929,149
200018930,149
200018931,149
200018932,715
200018933,174
200018936,144
200018937,233
200018938,80
200018939,129
200018940,89
200018941,45
200018942,79
200018950,85
200018952,218
200018963,89
200018966,179
200018967,80
200018969,69
200018971,178
200018972,193
200018973,69
200018974,199
200018981,198
200018989,317
200018990,178
200018991,198
200018993,168
200018994,99
200018995,376
200018999,118
200019002,89
200019006,69
200019007,207
200019011,89
200019014,50
200019016,258
200019018,158
200019019,174
200019023,79
200019028,89
200019041,198
200019046,89
200019047,50
200019053,278
200019059,79
200019060,317
200019063,247
200019064,193
200019066,129
200019071,99
200019072,269
200019077,397
200019079,45
200019080,79
200019081,229
200019082,69
200019083,164
200019084,129
200019086,99
200019087,45
200019089,99
200019090,119
200019093,89
200019102,89
200019103,179
200019104,85
200019105,527
200019106,179
200019107,279
200019108,159
200019113,259
200019114,80
200019115,264
200019116,219
200019117,219
200019118,189
200019119,239
200019120,169
200019121,159
200019122,90
200019124,85
200019125,169
200019126,229
200019127,119
200019128,179
200019129,259
200019130,179
200019131,169
200019134,259
200019135,259
200019136,65
200019137,199
200019138,219
200019139,179
200019140,179
200019141,100
200019142,359
200019143,304
200019144,119
200019145,179
200019146,259
200019147,189
200019148,85
200019149,90
200019150,90
200019151,219
200019152,159
200019153,219
200019154,199
200019157,259
200019158,249
200019159,80
200019160,368
200019161,428
200019162,120
200019165,85
200019166,169
200019167,100
200019168,90
200019169,169
200019170,119
200019173,85
200019174,259
200019177,189
200019178,80
200019179,179
200019180,219
200019181,159
200019182,219
200019183,179
200019184,169
200019185,109
200019186,90
200019187,219
200019188,169
200019189,179
200019190,90
200019191,90
200019193,259
200019194,209
200019195,65
200019196,254
200019197,229
200019198,90
200019199,119
200019200,75
200019201,219
200019203,119
200019204,109
200019205,249
200019206,70
200019207,418
200019208,90
200019209,50
200019210,178
200019211,89
200019212,70
200019213,229
200019214,169
200019215,109
200019216,109
200019217,200
200019218,79
200019219,349
200019221,159
200019223,90
200019224,169
200019225,100
200019226,169
200019227,50
200019229,189
200019230,159
200019231,119
200019232,49
200019233,90
200019234,219
200019235,519
200019236,249
200019237,75
200019238,100
200019239,175
200019240,339
200019241,189
200019242,169
200019243,75
200019244,80
200019245,160
200019246,259
200019247,169
200019248,259
200019249,100
200019251,248
200019252,90
200019253,249
200019254,70
200019255,199
200019257,283
200019258,259
200019259,219
200019260,307
200019262,139
200019263,90
200019264,149
200019265,298
200019266,278
200019267,100
200019268,139
200019269,255
200019270,85
200019271,50
200019272,50
200019273,50
200019274,109
200019275,219
200019276,348
200019277,219
200019278,448
200019281,169
200019283,89
200019288,100
200019294,528
200019297,65
200019298,357
200019299,154
200019311,89
200019313,149
200019314,129
200019316,104
200019320,69
200019325,99
200019332,69
200019333,139
200019335,119
200019337,139
200019339,124
200019341,109
200019343,386
220014984,302
220014986,60
220014987,89
220014988,119
220014990,89
220014991,169
220014993,65
220014994,49
220014996,418
220014997,129
220014998,79
220014999,100
220015000,39
220015001,89
220015002,85
220015003,139
220015004,89
220015009,124
220015010,45
220015011,129
220015012,89
220015013,129
220015014,119
220015016,100
220015022,89
220015027,139
220015028,79
220015029,199
220015031,164
220015032,312
220015034,109
220015035,174
220015038,79
220015039,119
220015041,75
220015042,174
220015044,658
220015050,55
220015054,95
220015055,119
220015057,188
220015059,248
220015061,299
220015062,80
220015064,394
220015066,199
220015069,129
220015072,89
220015073,119
220015075,99
220015077,70
220015079,363
220015081,138
220015082,80
220015084,299
220015086,95
220015088,80
220015090,149
220015094,138
220015095,409
220015096,89
220015097,69
220015098,80
220015100,160
220015103,80
220015105,165
220015107,218
220015108,137
220015109,140
220015111,79
220015112,99
220015116,99
220015119,308
220015122,99
220015123,99
220015125,149
220015126,254
220015127,69
220015128,119
220015129,148
220015130,1939
220015131,264
220015134,243
220015135,278
220015136,149
220015139,100
220015140,139
220015143,397
220015148,138
220015153,227
220015154,60
220015156,198
220015158,85
220015160,442
220015162,144
220015163,99
220015164,69
220015165,491
220015166,1411
220015168,243
220015169,49
220015174,49
220015176,138
220015177,10
220015178,10
220015179,119
220015180,119
220015181,316
220015182,204
220015183,209
220015184,139
220015185,109
220015186,79
220015187,70
220015188,70
220015190,189
220015191,79
220015192,503
220015193,89
220015196,129
220015197,190
220015198,607
220015199,299
220015202,179
220015203,95
220015204,139
220015206,80
230009526,89
230009527,328
230009528,89
230009529,80
230009530,89
230009532,89
230009533,89
230009535,89
230009536,89
230009537,49
230009539,89
230009540,89
230009541,89
230009543,90
230009545,85
230009547,50
230009548,69
230009549,308
230009550,89
230009551,39
230009552,49
230009553,257
230009554,98
230009555,89
230009556,89
230009557,129
230009559,69
230009562,456
230009563,209
230009564,214
230009565,194
230009566,218
230009567,283
230009568,89
230009569,208
230009570,228
230009571,204
230009572,317
230009573,474
230009574,180
230009575,138
230009576,681
230009577,228
230009578,412
230009579,362
230009580,148
230009581,228
230009582,158
230009583,342
230009586,178
230009587,148
230009588,89
230009589,278
230009590,119
230009591,119
230009592,663
230009593,99
230009594,516
230009595,144
230009596,89
230009597,228
230009598,436
230009599,467
230009600,397
230009601,89
230009602,1572
230009603,174
230009608,467
230009609,258
230009611,1181
230009616,307
230009617,200
230009618,89
230009619,99
230009620,1076
230009622,119
230009623,269
240005848,287
240005849,65
240005850,358
240005851,218
240005852,119
240005853,69
240005854,139
240005855,218
240005856,233
240005857,149
240005858,79
240005859,49
240005860,413
240005861,119
240005862,178
240005863,190
240005864,148
240005865,138
240005866,79
240005867,402
240005868,178
240005869,59
240005870,209
240005871,257
240005872,139
240005873,159
240005874,138
240005875,168
240005876,128
240005877,60
240005878,297
240005879,119
240005880,179
240005881,769
240005882,1395
240005884,79
240005885,287
240005890,89
240005893,99
240005894,119
250006292,45
250006293,228
250006295,306
250006296,119
250006298,8
250006299,69
250006301,69
250006302,89
250006303,119
250006304,347
250006305,49
250006307,208
250006308,178
250006309,89
250006310,158
250006311,168
250006312,237
250006314,377
250006315,189
250006317,129
250006318,69
250006319,308
250006320,40
250006321,89
250006323,227
250006324,69
250006325,247
250006326,129
250006329,502
250006331,69
250006332,60
250006333,178
250006335,134
250006339,89
250006341,618
250006342,258
250006343,158
250006344,299
250006345,109
250006347,124
250006348,158
250006349,69
250006351,89
250006352,158
250006353,475
250006354,517
250006355,129
250006356,109
250006357,40
250006359,184
250006360,149
250006361,139
250006362,79
250006364,129
250006365,606
250006366,89
250006367,585
250006368,154
250006371,843
250006372,89
250006373,666
250006374,287
250006375,141
250006378,257
250006379,89
250006381,190
250006383,99
250006384,148
250006385,198
250006386,69
270004534,129
270004535,139
270004537,89
270004538,416
270004539,154
270004543,129
270004544,89
270004546,89
270004547,59
270004548,199
270004549,79
270004550,149
270004551,269
270004552,507
270004553,517
270004555,174
270004557,65
270004558,178
270004559,75
270004560,178
270004561,128
270004562,69
270004564,39
270004565,11
270004569,128
270004571,287
270004572,148
270004574,423
270004575,273
270004576,139
270004577,89
270004579,342
270004580,658
270004583,79
270004588,316
270004593,401
270004596,158
270004597,304
270004598,407
270004599,227
270004601,1299
270004602,158
270004603,178
270004605,158
270004607,148
270004608,268
270004609,89
270004613,327
270004614,287
270004615,307
270004616,189
270004617,208
270004618,129
270004619,199
270004621,208
270004622,243
270004624,158
270004625,129
270004626,134
270004627,178
270004628,239
270004629,149
270004630,60
270004633,208
270004634,59
270004635,218
270004636,833
270004637,184
270004638,144
270004639,268
270004640,139
270004641,228
270004643,50
270004644,65
270004646,99
270004649,85
270004650,431
270004652,89
270004655,267
270004658,164
270004660,129
270004661,119
280002429,129
280002438,99
280002440,128
280002441,89
280002443,89
280002448,79
280002449,60
280002451,337
280002453,119
280002455,99
280002456,79
280002457,168
280002458,178
280002459,129
280002464,89
280002467,99
280002469,129
280002470,129
280002476,79
280002477,109
280002478,90
280002479,129
280002480,119
280002484,417
280002486,129
280002488,105
280002490,179
280002491,278
280002502,89
280002503,158
280002504,79
280002507,168
280002510,178
280002512,69
280002516,179
280002517,134
280002518,149
280002519,75
280002520,168
280002522,59
280002523,382
280002525,89
280002527,89
280002528,218
280002532,178
280002533,89
280002535,99
280002542,144
280002547,188
280002548,89
280002549,179
280002550,258
280002551,154
280002552,129
280002556,139
280002557,119
280002558,89
280002559,198
280002563,248
280002567,129
310000411,69
310000413,179
310000414,268
310000415,159
310000416,306
310000419,159
310000420,159
310000421,45
310000423,69
310000424,79
310000425,59
310000426,109
310000427,129
310000428,79
310000430,158
310000432,174
310000433,148
310000434,418
310000435,119
310000436,447
310000438,218
310000439,178
310000440,204
310000441,504
310000442,601
310000445,109
310000446,361
310000447,178
310000448,378
310000449,238
310000451,213
310000452,309
310000453,227
310000454,517
310000455,89
310000456,194
310000457,347
310000459,89
310000460,95
310000461,65
310000462,128
310000463,188
";


# should be executed every day at 04:30AM

require_once 'utils.php';
require_once 'dbLogInfo.php';

$db_youfid  = new mysqli($host, $username, $password, "youfid");

# ...
echo 'Injection dans la table youfid.sinequanone_tickets' . PHP_EOL;
# ...

foreach(preg_split("/((\r?\n)|(\r\n?))/", $csv) as $line)
{
	$data = explode(',', $line);
	foreach ($data as $key => $value)
		if(substr($value, 0, 1) == '"')
			$data[$key] = trim(strtolower(str_replace('"', '', $value)));

	// id_panier;Email du contact;total_base_ttc;date_achat;code_coupon
	$ticket_id   = @$data[0];
	$amount      = @$data[1];

	if($amount == 0 or empty($ticket_id))
		continue;

	$amount = $amount * 100;
	$db_youfid->query("
		UPDATE `sinequanone_tickets`
		SET `amount` = " . intval($amount) . "
		WHERE `ticket_id` LIKE '%" . $ticket_id . "'
	");

}



